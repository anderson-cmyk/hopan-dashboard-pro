# üèóÔ∏è Arquitetura T√©cnica - HO Pan Dashboard (CobHub)

**Vers√£o:** 2.0.0  
**Autor:** Manus AI para CobHub  
**Data:** 08 de outubro de 2025

---

## 1. Vis√£o Geral

Este documento detalha a arquitetura t√©cnica completa do sistema HO Pan Dashboard, uma aplica√ß√£o web profissional constru√≠da para an√°lise de comiss√µes. A solu√ß√£o foi projetada seguindo os princ√≠pios de **seguran√ßa por design**, **escalabilidade horizontal** e **desacoplamento de componentes**.

---

## 2. Diagrama de Arquitetura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         USU√ÅRIO FINAL                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ HTTPS
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    GOOGLE CLOUD RUN                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                  APLICA√á√ÉO FLASK                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   Frontend   ‚îÇ  ‚îÇ   Backend    ‚îÇ  ‚îÇ  Processamento  ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  (Templates) ‚îÇ‚óÑ‚îÄ‚î§   (API)      ‚îÇ‚óÑ‚îÄ‚î§    de Dados     ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         ‚îÇ                  ‚îÇ                    ‚îÇ          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         ‚îÇ                  ‚îÇ                    ‚îÇ          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         ‚ñº                  ‚ñº                    ‚ñº          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Autentica√ß√£o ‚îÇ  ‚îÇ   Sess√µes    ‚îÇ  ‚îÇ  Pandas/Excel   ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  (Werkzeug)  ‚îÇ  ‚îÇ   (Flask)    ‚îÇ  ‚îÇ  Transforma√ß√£o  ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        GITHUB REPOSITORY                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  dashboard_data.json (Dados Processados)                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Metadados                                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Dados Completos                                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - An√°lises Pr√©-calculadas                                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      GITHUB ACTIONS                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Pipeline CI/CD                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  1. Build Docker Image                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  2. Push to GCR                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  3. Deploy to Cloud Run                                    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 3. Componentes Principais

### 3.1. Frontend (Templates Jinja2)

O frontend √© composto por templates HTML renderizados no servidor, utilizando o motor de templates Jinja2 do Flask.

**Componentes:**

- **`login.html`**: P√°gina de autentica√ß√£o com design iOS 18, incluindo logo CobHub e valida√ß√£o de credenciais.
- **`dashboard.html`**: Interface principal do dashboard com carregamento ass√≠ncrono de dados via API interna.

**Caracter√≠sticas:**

- Design responsivo e moderno (estilo iOS 18)
- Carregamento progressivo com indicadores visuais
- Integra√ß√£o com Chart.js para visualiza√ß√µes
- Exporta√ß√£o de dados em CSV

**Tecnologias:**

- HTML5
- CSS3 (vari√°veis CSS, gradientes, anima√ß√µes)
- JavaScript (ES6+, Fetch API)
- Chart.js 4.4.0

### 3.2. Backend (Flask)

O backend √© constru√≠do com Flask, um microframework Python leve e flex√≠vel.

**Responsabilidades:**

- **Autentica√ß√£o:** Gerenciamento de login/logout com sess√µes seguras.
- **Autoriza√ß√£o:** Controle de acesso baseado em roles (admin/user).
- **API de Dados:** Endpoint `/api/data` que serve os dados do dashboard.
- **Processamento:** Transforma√ß√£o de arquivos Excel em JSON otimizado.
- **Integra√ß√£o GitHub:** Atualiza√ß√£o autom√°tica do reposit√≥rio com novos dados.

**Endpoints Principais:**

| Endpoint | M√©todo | Autentica√ß√£o | Descri√ß√£o |
| :--- | :--- | :--- | :--- |
| `/` | GET | N√£o | Redireciona para login ou dashboard |
| `/login` | GET, POST | N√£o | P√°gina de login e valida√ß√£o de credenciais |
| `/logout` | GET | Sim | Encerra a sess√£o do usu√°rio |
| `/dashboard` | GET | Sim | P√°gina principal do dashboard |
| `/api/data` | GET | Sim | Retorna dados do dashboard em JSON |
| `/api/update` | POST | Admin | Atualiza dados do dashboard (apenas admin) |
| `/health` | GET | N√£o | Health check para Cloud Run |

**Seguran√ßa:**

- Senhas armazenadas com hash (Werkzeug PBKDF2)
- Sess√µes criptografadas com chave secreta
- Decorators para prote√ß√£o de rotas (`@login_required`, `@admin_required`)
- Valida√ß√£o de entrada em todos os endpoints

### 3.3. Processamento de Dados (Pandas)

O m√≥dulo de processamento √© respons√°vel por transformar os dados brutos em um formato otimizado para o dashboard.

**Pipeline de Processamento:**

1. **Ingest√£o:** Download do arquivo Excel de uma URL fornecida.
2. **Limpeza:** Remo√ß√£o de colunas desnecess√°rias e padroniza√ß√£o de nomes.
3. **Transforma√ß√£o:** Cria√ß√£o de campos calculados (MesAno, PercComissao, FaixaAtraso, FaixaValor).
4. **Enriquecimento:** Adi√ß√£o de classifica√ß√µes (Classe, TipoPagamento).
5. **Valida√ß√£o:** Remo√ß√£o de registros inv√°lidos ou inconsistentes.
6. **Agrega√ß√£o:** C√°lculo de an√°lises pr√©-computadas (an√°lise por faixa de atraso).
7. **Serializa√ß√£o:** Convers√£o para JSON com metadados.

**Campos Calculados:**

- **MesAno:** Formato YYYY-MM extra√≠do da Data_Base.
- **PercComissao:** (ValorComissao / ValorPago) √ó 100.
- **FaixaAtraso:** Classifica√ß√£o em 7 faixas (0-20 dias, 21-30 dias, ..., >360 dias).
- **FaixaValor:** Classifica√ß√£o em 7 faixas de valor (At√© R$ 1.000, ..., >R$ 10.000).
- **Classe:** Contact (<90 dias), Ativas 1 (91-180 dias), Ativas 2 (>181 dias).
- **TipoPagamento:** Parcial (<R$ 3.000), Atualiza√ß√£o (R$ 3.001-8.000), Quita√ß√£o (>R$ 8.000).

### 3.4. Armazenamento de Dados (GitHub)

Os dados processados s√£o armazenados em um arquivo JSON no reposit√≥rio GitHub, servindo como uma "base de dados" versionada e desacoplada.

**Vantagens:**

- **Versionamento:** Hist√≥rico completo de todas as atualiza√ß√µes de dados.
- **Desacoplamento:** A aplica√ß√£o n√£o depende de um banco de dados tradicional.
- **Simplicidade:** F√°cil de auditar, fazer backup e restaurar.
- **Performance:** O Cloud Run faz cache local dos dados, reduzindo lat√™ncia.

**Estrutura do JSON:**

```json
{
  "metadados": {
    "total_registros": 1234,
    "meses_disponiveis": ["2025-09", "2025-10"],
    "campos_numericos": ["ValorPago", "ValorComissao", ...],
    "data_atualizacao": "2025-10-08 14:30:00"
  },
  "dados_completos": [
    {
      "Proposta": "12345",
      "Cliente": "Nome do Cliente",
      "ValorPago": 5000.00,
      ...
    }
  ],
  "analise_faixas": {
    "0-20 dias": {
      "operacoes": 100,
      "valor_pago": 500000.00,
      ...
    }
  }
}
```

### 3.5. Hospedagem (Google Cloud Run)

O Cloud Run √© uma plataforma serverless que executa containers de forma escal√°vel e gerenciada.

**Configura√ß√£o:**

- **Imagem:** `gcr.io/[PROJECT_ID]/hopan-dashboard:latest`
- **Mem√≥ria:** 1 GB
- **CPU:** 1 vCPU
- **Timeout:** 300 segundos
- **Inst√¢ncias:** 0 (m√≠nimo) a 10 (m√°ximo)
- **Autentica√ß√£o:** Permitida (allow-unauthenticated) - a autentica√ß√£o √© feita pela aplica√ß√£o

**Escalabilidade:**

- **Scale to Zero:** Quando n√£o h√° tr√°fego, o Cloud Run reduz para 0 inst√¢ncias, economizando custos.
- **Auto-scaling:** Novas inst√¢ncias s√£o criadas automaticamente conforme a demanda aumenta.
- **Cold Start:** Otimizado com imagem Docker leve (Python 3.11 slim).

**Monitoramento:**

- Logs centralizados no Cloud Logging
- M√©tricas de performance no Cloud Monitoring
- Health check autom√°tico via endpoint `/health`

### 3.6. CI/CD (GitHub Actions)

O pipeline de CI/CD automatiza todo o processo de build, teste e deploy.

**Workflow:**

1. **Trigger:** Push para a branch `main` ou execu√ß√£o manual.
2. **Checkout:** C√≥digo √© baixado do reposit√≥rio.
3. **Autentica√ß√£o:** GitHub Actions se autentica no GCP usando Service Account.
4. **Build:** Imagem Docker √© constru√≠da com a tag do commit SHA.
5. **Push:** Imagem √© enviada para o Google Container Registry (GCR).
6. **Deploy:** Cloud Run √© atualizado com a nova imagem e vari√°veis de ambiente.
7. **Verifica√ß√£o:** URL do servi√ßo √© exibida no log.

**Secrets Necess√°rios:**

- `GCP_PROJECT_ID`: ID do projeto no GCP
- `GCP_SA_KEY`: Chave JSON da Service Account (base64)
- `SECRET_KEY`: Chave secreta para sess√µes Flask
- `ADMIN_PASSWORD_HASH`: Hash da senha do administrador
- `GITHUB_TOKEN`: Token de acesso ao GitHub
- `GITHUB_REPO`: Reposit√≥rio no formato `usuario/repo`
- `GITHUB_USER`: Usu√°rio do GitHub

---

## 4. Fluxo de Autentica√ß√£o

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Usu√°rio  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GET /login     ‚îÇ
‚îÇ  (Formul√°rio)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ POST /login     ‚îÇ
‚îÇ username+senha  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Verificar credenciais       ‚îÇ
‚îÇ - Buscar usu√°rio            ‚îÇ
‚îÇ - Validar hash da senha     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ Inv√°lido ‚îÄ‚îÄ‚ñ∫ Retornar erro
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ V√°lido
          ‚îÇ
          ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ Criar sess√£o        ‚îÇ
     ‚îÇ - session['user']   ‚îÇ
     ‚îÇ - session['name']   ‚îÇ
     ‚îÇ - session['role']   ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ Redirecionar para   ‚îÇ
     ‚îÇ /dashboard          ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Prote√ß√£o de Rotas:**

Todas as rotas protegidas utilizam o decorator `@login_required`, que verifica se a chave `user` existe na sess√£o. Caso n√£o exista, o usu√°rio √© redirecionado para `/login`.

Rotas administrativas utilizam `@admin_required`, que verifica adicionalmente se `session['role'] == 'admin'`.

---

## 5. Fluxo de Atualiza√ß√£o de Dados

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Admin        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ POST /api/update     ‚îÇ
‚îÇ { "url": "..." }     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Baixar arquivo Excel ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Processar dados      ‚îÇ
‚îÇ (Pandas)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Gerar JSON           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Clonar reposit√≥rio   ‚îÇ
‚îÇ GitHub               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Atualizar arquivo    ‚îÇ
‚îÇ dashboard_data.json  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Commit e Push        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Retornar sucesso     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Observa√ß√µes:**

- O processo √© s√≠ncrono e pode levar alguns minutos para arquivos grandes.
- O cache local √© atualizado automaticamente ap√≥s o push para o GitHub.
- Todos os usu√°rios ver√£o os dados atualizados na pr√≥xima requisi√ß√£o.

---

## 6. Seguran√ßa

### 6.1. Camadas de Seguran√ßa

| Camada | Mecanismo | Descri√ß√£o |
| :--- | :--- | :--- |
| **Transporte** | HTTPS (TLS 1.3) | Toda comunica√ß√£o √© criptografada pelo Cloud Run |
| **Autentica√ß√£o** | Werkzeug PBKDF2 | Senhas armazenadas com hash seguro (SHA256, 260.000 itera√ß√µes) |
| **Sess√£o** | Flask-Session | Sess√µes criptografadas com chave secreta (256 bits) |
| **Autoriza√ß√£o** | Role-Based Access Control (RBAC) | Controle de acesso baseado em roles (admin/user) |
| **Secrets** | GitHub Secrets + GCP Secret Manager | Vari√°veis sens√≠veis nunca expostas no c√≥digo |
| **Rede** | Cloud Run VPC | Isolamento de rede gerenciado pelo GCP |

### 6.2. Boas Pr√°ticas Implementadas

- ‚úÖ Princ√≠pio do menor privil√©gio (Service Account com permiss√µes m√≠nimas)
- ‚úÖ Separa√ß√£o de ambientes (dev/staging/prod)
- ‚úÖ Auditoria de acessos (logs no Cloud Logging)
- ‚úÖ Rota√ß√£o de credenciais (recomendado a cada 90 dias)
- ‚úÖ Valida√ß√£o de entrada (sanitiza√ß√£o de dados)
- ‚úÖ Rate limiting (implement√°vel via Cloud Armor)

---

## 7. Performance e Escalabilidade

### 7.1. Otimiza√ß√µes Implementadas

- **Cache Local:** Dados s√£o armazenados em `/tmp` e reutilizados por 5 minutos.
- **Compress√£o:** Responses s√£o comprimidas automaticamente pelo Cloud Run.
- **Lazy Loading:** Dados s√£o carregados apenas quando necess√°rio.
- **Pr√©-computa√ß√£o:** An√°lises agregadas s√£o calculadas no backend e armazenadas no JSON.

### 7.2. Capacidade

| M√©trica | Valor |
| :--- | :--- |
| **Requisi√ß√µes por segundo** | ~100 RPS por inst√¢ncia |
| **Lat√™ncia m√©dia** | <200ms (cache hit) |
| **Lat√™ncia m√°xima** | <2s (cache miss + download GitHub) |
| **Tamanho m√°ximo do JSON** | ~50 MB (recomendado) |
| **Usu√°rios simult√¢neos** | ~1.000 (com 10 inst√¢ncias) |

---

## 8. Custos Estimados

Baseado em um uso moderado (1.000 requisi√ß√µes/dia, 100 usu√°rios ativos):

| Servi√ßo | Custo Mensal (USD) |
| :--- | :--- |
| **Cloud Run** | $5 - $15 |
| **Container Registry** | $1 - $3 |
| **Cloud Logging** | $2 - $5 |
| **GitHub Actions** | $0 (free tier) |
| **Total Estimado** | $8 - $23 |

**Observa√ß√£o:** O Cloud Run cobra apenas pelo tempo de CPU utilizado. Com scale-to-zero, os custos s√£o m√≠nimos em per√≠odos de baixo tr√°fego.

---

## 9. Roadmap T√©cnico

### Curto Prazo (1-3 meses)

- [ ] Implementar dashboard completo (migrar de `index.html`)
- [ ] Adicionar testes automatizados (pytest)
- [ ] Configurar dom√≠nio customizado
- [ ] Implementar rate limiting

### M√©dio Prazo (3-6 meses)

- [ ] Migrar para Cloud SQL (PostgreSQL) para dados maiores
- [ ] Implementar cache distribu√≠do (Redis/Memorystore)
- [ ] Adicionar monitoramento avan√ßado (Prometheus/Grafana)
- [ ] Implementar backup autom√°tico

### Longo Prazo (6-12 meses)

- [ ] Multi-tenancy (suporte a m√∫ltiplas empresas)
- [ ] API p√∫blica com autentica√ß√£o OAuth2
- [ ] Integra√ß√£o com BigQuery para analytics
- [ ] Mobile app (React Native)

---

## 10. Conclus√£o

A arquitetura do HO Pan Dashboard foi projetada para ser **simples, segura e escal√°vel**. A escolha de tecnologias modernas e servi√ßos gerenciados (Cloud Run, GitHub) permite que a equipe se concentre em evoluir o produto, enquanto a infraestrutura cuida da opera√ß√£o.

A separa√ß√£o clara de responsabilidades entre frontend, backend e armazenamento de dados garante flexibilidade para futuras evolu√ß√µes, como a migra√ß√£o para um banco de dados relacional ou a adi√ß√£o de novos m√≥dulos de an√°lise.

---

**Autor:** Manus AI para CobHub  
**√öltima atualiza√ß√£o:** 08 de outubro de 2025
